<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Agentic Academic Guardian</title>
  <style>
  :root{
    --bg: #fff6eb;
    --panel: #fffaf3;
    --card: #ffffffcc;
    --sidebar: linear-gradient(180deg, #ffd6df 0%, #ffe7cf 40%, #fff0d9 100%);
    --accent: #b8a6ff;
    --accent-2: #ffd29e;
    --text: #2b2b2b;
    --muted: #7a7a7a;
    --shadow: 0 10px 25px rgba(30, 20, 10, 0.08);
    --shadow-soft: 0 6px 18px rgba(30, 20, 10, 0.06);
    --radius-xl: 22px;
    --radius-lg: 16px;
    --radius-md: 12px;
    --border: 1px solid rgba(60,40,20,0.08);
  }

  *{ box-sizing:border-box; }
  body{
    margin:0;
    font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;
    background: radial-gradient(1200px 700px at 20% 0%, #ffe3ea 0%, transparent 55%),
                radial-gradient(1200px 700px at 100% 20%, #ffe9cf 0%, transparent 55%),
                var(--bg);
    color: var(--text);
  }

  /* App layout */
  .app{
    min-height:100vh;
    display:grid;
    grid-template-columns: 260px 1fr 320px;
    gap: 22px;
    padding: 18px;
  }

  /* Sidebar */
  .sidebar{
    background: var(--sidebar);
    border-radius: var(--radius-xl);
    box-shadow: var(--shadow);
    padding: 18px;
    display:flex;
    flex-direction:column;
    gap: 16px;
    border: var(--border);
  }
  .brand{
    font-weight:800;
    letter-spacing:0.2px;
    font-size: 20px;
    color:#8b7cff;
    opacity:0.95;
    padding: 6px 8px;
  }
  .nav{
    display:flex;
    flex-direction:column;
    gap: 10px;
    padding-top: 8px;
  }
  .nav a{
    text-decoration:none;
    color: #4a4a4a;
    padding: 12px 14px;
    border-radius: 14px;
    display:flex;
    justify-content:space-between;
    align-items:center;
    border: 1px solid transparent;
  }
  .nav a.active{
    background: rgba(184,166,255,0.25);
    border-color: rgba(184,166,255,0.35);
    box-shadow: 0 6px 16px rgba(184,166,255,0.18);
    font-weight:700;
  }
  .badge{
    font-size:12px;
    padding: 4px 10px;
    border-radius:999px;
    background: rgba(255,255,255,0.55);
    border: var(--border);
    color: var(--muted);
  }

  /* Main */
  .main{
    background: rgba(255,250,243,0.55);
    border-radius: var(--radius-xl);
    padding: 18px;
    border: var(--border);
    box-shadow: var(--shadow-soft);
    overflow:hidden;
  }
  .topbar{
    display:flex;
    justify-content:space-between;
    align-items:center;
    padding: 14px 16px;
    background: rgba(255, 235, 205, 0.55);
    border: var(--border);
    border-radius: var(--radius-xl);
    box-shadow: var(--shadow-soft);
    margin-bottom: 16px;
  }
  .topbar h1{
    font-size: 18px;
    margin:0;
    font-weight:800;
  }
  .topbar .date{
    font-weight:700;
    color: var(--muted);
    font-size: 13px;
  }

  /* Add Task strip */
  .composer{
    display:flex;
    gap: 10px;
    align-items:center;
    background: rgba(255,255,255,0.6);
    border: var(--border);
    border-radius: var(--radius-xl);
    padding: 12px;
    box-shadow: var(--shadow-soft);
    margin-bottom: 18px;
    flex-wrap:wrap;
  }
  .composer input, .composer select{
    height: 42px;
    border-radius: 14px;
    border: var(--border);
    background: rgba(255, 236, 218, 0.55);
    padding: 0 12px;
    outline:none;
    min-width: 160px;
  }
  .composer input#title{ min-width: 320px; flex:1; }
  .btn{
    height: 42px;
    padding: 0 16px;
    border: none;
    border-radius: 14px;
    background: var(--accent);
    color: white;
    font-weight: 800;
    box-shadow: 0 10px 20px rgba(184,166,255,0.35);
    cursor:pointer;
  }
  .btn:active{ transform: translateY(1px); }
  .btn.secondary{
    background: rgba(255,255,255,0.65);
    color: #4b4b4b;
    border: var(--border);
    box-shadow: var(--shadow-soft);
  }

  /* Section headers like "Thursday, Jan 1, 2026" */
  .section-title{
    display:flex;
    align-items:center;
    justify-content:space-between;
    margin: 14px 4px 10px;
    color:#5c5c5c;
    font-weight:800;
  }
  .section-title small{
    color: var(--muted);
    font-weight:700;
  }

  /* Task / Plan cards */
  .task-card, .plan-card, .action-card{
    position:relative;
    background: rgba(255,255,255,0.68);
    border: var(--border);
    border-radius: var(--radius-xl);
    padding: 14px 14px 14px 18px;
    box-shadow: var(--shadow-soft);
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap: 12px;
    margin: 10px 0;
    overflow:hidden;
  }

  /* Colored left bar */
  .task-card::before{
    content:"";
    position:absolute;
    left:0; top:0; bottom:0;
    width: 8px;
    border-radius: var(--radius-xl) 0 0 var(--radius-xl);
    background: #ff9aa6;
  }
  .bar-orange::before{ background:#ffb36a; }
  .bar-green::before{ background:#74d98a; }
  .bar-purple::before{ background:#b8a6ff; }
  .bar-red::before{ background:#ff6b6b; }

  .task-info{
    display:flex;
    flex-direction:column;
    gap:4px;
    min-width: 260px;
  }
  .task-title{
    font-weight:900;
    font-size: 15px;
    margin:0;
  }
  .task-meta{
    color: var(--muted);
    font-size: 12px;
    font-weight:700;
  }

  .task-actions{
    display:flex;
    gap:8px;
    align-items:center;
  }
  .icon-btn{
    width: 38px;
    height: 38px;
    border-radius: 14px;
    border: var(--border);
    background: rgba(255,255,255,0.65);
    box-shadow: var(--shadow-soft);
    cursor:pointer;
    display:grid;
    place-items:center;
    font-weight:900;
  }

  /* Right panel */
  .right{
    background: rgba(255,250,243,0.75);
    border-radius: var(--radius-xl);
    padding: 16px;
    border: var(--border);
    box-shadow: var(--shadow);
  }
  .right .mini-header{
    display:flex;
    justify-content:space-between;
    align-items:flex-start;
    margin-bottom: 12px;
  }
  .right .mini-header .label{
    color: var(--muted);
    font-size: 12px;
    font-weight:800;
  }
  .right .mini-header .value{
    font-size: 18px;
    font-weight:900;
  }

  .calendar{
    background: rgba(255, 238, 218, 0.55);
    border: var(--border);
    border-radius: var(--radius-xl);
    padding: 12px;
    box-shadow: var(--shadow-soft);
  }
  .cal-head{
    display:flex;
    justify-content:space-between;
    align-items:center;
    margin-bottom: 10px;
    font-weight:900;
  }
  .cal-grid{
    display:grid;
    grid-template-columns: repeat(7, 1fr);
    gap: 10px;
    font-size: 12px;
  }
  .dow{
    text-align:center;
    color: var(--muted);
    font-weight:800;
  }
  .day{
    height: 46px;
    border-radius: 16px;
    background: rgba(255,255,255,0.55);
    border: var(--border);
    display:flex;
    align-items:center;
    justify-content:center;
    position:relative;
    font-weight:900;
  }
  .dot{
    width: 6px; height:6px; border-radius:999px;
    position:absolute; left:10px; bottom:10px;
    background:#ff6b6b;
  }
  .dot.orange{ background:#ffb36a; }
  .dot.green{ background:#74d98a; }

  /* Responsive */
  @media (max-width: 1100px){
    .app{ grid-template-columns: 240px 1fr; }
    .right{ display:none; }
  }
  @media (max-width: 760px){
    .app{ grid-template-columns: 1fr; }
    .sidebar{ display:none; }
  }
</style>

</head>
<body>
  <div class="app">

    <!-- Sidebar -->
    <aside class="sidebar">
      <div class="brand">TaskFlow</div>
      <nav class="nav">
        <a class="active" href="javascript:void(0)">Dashboard</a>
        <a href="javascript:void(0)">Completed <span class="badge" id="completedCount">0</span></a>
      </nav>
    </aside>

    <!-- Main -->
    <main class="main">
      <div class="topbar">
        <h1>Hi — Your Tasks</h1>
        <div class="date" id="prettyDate">—</div>
      </div>

      <!-- Add Task -->
      <div class="composer">
        <input id="title" placeholder="What do you want to do?" />
        <select id="type">
          <option value="exam_topic">exam_topic</option>
          <option value="assignment">assignment</option>
          <option value="revision">revision</option>
        </select>
        <input id="due_date" type="date" />
        <input id="mins" type="number" value="60" min="10" />
        <input id="prio" type="number" value="3" min="1" max="5" />
        <button class="btn" onclick="addTask()">Add Task</button>
        <button class="btn secondary" onclick="loadTasks()">Refresh</button>
      </div>

      <!-- Tasks -->
      <div class="section-title">
        <span>Tasks</span>
        <small id="taskCount">0 task</small>
      </div>
      <div id="tasks"></div>

      <!-- Plan -->
      <div class="section-title">
        <span>Plan</span>
        <small>auto updates on skip</small>
      </div>
      <div class="row" style="display:flex; gap:10px; flex-wrap:wrap; margin-bottom:10px;">
        <input id="plan_date" type="date" />
        <button class="btn" onclick="generatePlan()">Generate Plan</button>
        <button class="btn secondary" onclick="loadPlan()">Load Saved</button>
      </div>
      <div id="plan"></div>

      <!-- Agent Actions -->
      <div class="section-title">
        <span>Agent Actions</span>
        <small>explainable decisions</small>
      </div>
      <div id="actions"></div>
    </main>

    <!-- Right Panel -->
    <aside class="right">
      <div class="mini-header">
        <div>
          <div class="label">Current time</div>
          <div class="value" id="clock">--:--:--</div>
        </div>
        <div style="text-align:right">
          <div class="label">Today</div>
          <div class="value" id="todayLabel">--</div>
        </div>
      </div>

      <div class="calendar">
        <div class="cal-head">
          <span>Calendar</span>
          <span class="badge" id="calMonth">—</span>
        </div>
        <div class="cal-grid" id="calendarGrid"></div>
      </div>
    </aside>

  </div>

  <script>
    const API = "http://127.0.0.1:5000";

    function todayISO() {
      const d = new Date();
      const m = String(d.getMonth() + 1).padStart(2, "0");
      const day = String(d.getDate()).padStart(2, "0");
      return `${d.getFullYear()}-${m}-${day}`;
    }

    // Default dates
    document.getElementById("plan_date").value = todayISO();
    document.getElementById("due_date").value = todayISO();

    // ---------- UI: clock ----------
    function tick() {
      const d = new Date();
      document.getElementById("clock").textContent = d.toLocaleTimeString();
      document.getElementById("prettyDate").textContent =
        d.toLocaleDateString(undefined, { weekday: "long", month: "long", day: "numeric" });
      document.getElementById("todayLabel").textContent =
        d.toLocaleDateString(undefined, { month: "short", day: "numeric" });
    }
    setInterval(tick, 1000);
    tick();

    // ---------- UI: calendar ----------
    function buildCalendar() {
      const grid = document.getElementById("calendarGrid");
      const d = new Date();
      const year = d.getFullYear();
      const month = d.getMonth();

      document.getElementById("calMonth").textContent =
        d.toLocaleDateString(undefined, { month: "short" });

      const first = new Date(year, month, 1);
      const startDay = (first.getDay() + 6) % 7; // Mon=0
      const daysInMonth = new Date(year, month + 1, 0).getDate();

      const dows = ["Mon", "Tue", "Wed", "Thu", "Fri", "Sat", "Sun"];
      grid.innerHTML = dows.map(x => `<div class="dow">${x}</div>`).join("");

      for (let i = 0; i < startDay; i++) {
        grid.innerHTML += `<div class="day" style="opacity:.35"></div>`;
      }

      for (let day = 1; day <= daysInMonth; day++) {
        const isToday = day === d.getDate();
        grid.innerHTML += `
          <div class="day" style="${isToday ? "outline:2px solid rgba(184,166,255,.55)" : ""}">
            ${day}
            ${isToday ? `<span class="dot orange"></span>` : ""}
          </div>
        `;
      }
    }
    buildCalendar();

    // ---------- API: tasks ----------
    async function addTask() {
      const body = {
        title: document.getElementById("title").value.trim(),
        type: document.getElementById("type").value,
        due_date: document.getElementById("due_date").value,
        estimated_minutes: Number(document.getElementById("mins").value || 60),
        priority: Number(document.getElementById("prio").value || 3),
      };

      if (!body.title || !body.due_date) return alert("Title + due_date required");

      const res = await fetch(`${API}/tasks`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(body),
      });

      if (!res.ok) return alert("Failed to add task");

      document.getElementById("title").value = "";
      await loadTasks();
      await loadActions();
    }

    async function loadTasks() {
      const res = await fetch(`${API}/tasks`);
      const tasks = await res.json();

      document.getElementById("taskCount").textContent = `${tasks.length} task`;
      document.getElementById("completedCount").textContent =
        tasks.filter(t => t.status === "done").length;

      const colorClass = (t) => {
        if (t.status === "skipped") return "bar-red";
        if (Number(t.priority) >= 5) return "bar-purple";
        if (Number(t.priority) === 4) return "bar-orange";
        return "bar-green";
      };

      const el = document.getElementById("tasks");
      el.innerHTML = tasks.map(t => `
        <div class="task-card ${colorClass(t)}">
          <div class="task-info">
            <div class="task-title">${t.title}</div>
            <div class="task-meta">${t.due_date} • ${t.type} • priority ${t.priority} • ${t.estimated_minutes} mins</div>
          </div>
          <div class="task-actions">
            <button class="icon-btn" title="Done" onclick="markProgress('${t.task_id}','done')">✓</button>
            <button class="icon-btn" title="Skipped" onclick="markProgress('${t.task_id}','skipped')">–</button>
          </div>
        </div>
      `).join("");
    }

    // ---------- API: plan ----------
    async function generatePlan() {
  const date = document.getElementById("plan_date").value;

  const res = await fetch(`${API}/plan/${date}`, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ items: [] })
  });

  if (!res.ok) {
    alert("Plan generation failed");
    return;
  }

  await loadPlan();
  await loadActions();
}


    async function loadPlan() {
  const date = document.getElementById("plan_date").value;
  const res = await fetch(`${API}/plan/${date}`);
  const data = await res.json();
  renderPlan(data.items || [], `Saved plan for ${date}`);
}


    function renderPlan(items, title) {
      const el = document.getElementById("plan");

      if (!items || items.length === 0) {
        el.innerHTML = `
          <div class="plan-card bar-green">
            <div class="task-info">
              <div class="task-title">${title}</div>
              <div class="task-meta">empty</div>
            </div>
          </div>
        `;
        return;
      }

      el.innerHTML = `
        <div class="plan-card bar-green">
          <div class="task-info">
            <div class="task-title">${title}</div>
            <div class="task-meta">${items.length} focus blocks</div>
          </div>
        </div>
        ${items.map(i => `
          <div class="task-card bar-green">
            <div class="task-info">
              <div class="task-title">${i.title}</div>
              <div class="task-meta">${i.duration_minutes} mins • ${i.note || ""}</div>
            </div>
          </div>
        `).join("")}
      `;
    }

    // ---------- API: progress ----------
    async function markProgress(task_id, status) {
      const res = await fetch(`${API}/progress`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          task_id,
          status,
          minutes_spent: status === "done" ? 30 : 0,
          reason: status === "skipped" ? "tired" : null
        }),
      });

      if (!res.ok) return alert("Progress failed");

      await loadTasks();
      await loadPlan();
      await loadActions();
    }

    // ---------- API: actions ----------
    async function loadActions() {
      const res = await fetch(`${API}/actions`);
      const actions = await res.json();
      const el = document.getElementById("actions");

      el.innerHTML = actions.map(a => `
        <div class="action-card bar-purple">
          <div class="task-info">
            <div class="task-title">${a.action_type}</div>
            <div class="task-meta">${a.timestamp}</div>
            <div style="margin-top:6px; font-weight:700;">${a.rationale}</div>
            <div class="task-meta">${a.diff || ""}</div>
          </div>
        </div>
      `).join("");
    }

    // Initial load
    loadTasks();
    loadActions();
  </script>
</body>
</html>

